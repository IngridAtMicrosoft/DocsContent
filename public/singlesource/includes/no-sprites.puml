@startuml
' Styling
skinparam defaultTextAlignment center
skinparam defaultFontSize 12
skinparam defaultFontName Segoe UI
skinparam defaultBackgroundColor white
skinparam RectangleBackgroundColor white
skinparam RectangleBorderColor #3C7FC0
skinparam WrapWidth 100
skinparam linetype ortho
'horizonal spacing
'skinparam nodesep 10
skinparam ranksep 5

skinparam rectangle {
    BorderThickness 3
    Shadowing false
}
skinparam database {
    BackgroundColor white
    Shadowing false
}

' ##################################
'Special styling for db
skinparam RectangleBackgroundColor<<db>> #CCCCCC
skinparam RectangleBorderColor<<db>> #CCCCCC
skinparam RoundCorner<<db>> 20
skinparam WrapWidth<<db>> 20

'Special styling for brackets
skinparam RectangleBorderColor<<grey>> #CCCCCC
skinparam RectangleBorderThickness<<grey>> 3
skinparam RoundCorner<<grey>> 20

'Special styling for sources
skinparam RectangleBorderColor<<srcs>> #CCCCCC
skinparam RectangleBorderThickness<<srcs>> 3

'Special stying for actions
skinparam RoundCorner<<action>> 20

'Special no border styling
skinparam RectangleBorderThickness<<noborder>> 1

'Hide the above from showing up in the diagram
hide <<grey>> stereotype
hide <<db>> stereotype
hide <<action>> stereotype
hide <<noborder>> stereotype
hide <<srcs>> stereotype

together {
rectangle "Sources" as sources {
    rectangle " " as leftbracket <<srcs>> {
        'rectangle "Static Apps" <<$StaticApps{scale=3}>> as StaticApps
        'rectangle "Operating System" as OperatingSystem
        'rectangle "Subscriptions" <<$Subscriptions{scale=3}>> as Subscriptions
        'rectangle "Tenant" as Tenant
        'rectangle "Resource Groups" <<$ResourceGroups{scale=3}>> as ResourceGroups
        'rectangle "My Customers" <<$MyCustomers{scale=3}>> as MyCustomers
        rectangle "Resource Groups" as ResourceGroups <<db>>
        rectangle "Application" as Application <<db>>
        rectangle "Operating System" as OperatingSystem <<db>>
        rectangle "Subscriptions" as Subscriptions <<db>>
        rectangle "Tenant" as Tenant <<db>>
        rectangle "My Customers" as MyCustomers <<db>>
        'StaticApps -[hidden]d- OperatingSystem
        ResourceGroups -[hidden]d- Application
        Application -[hidden]d- OperatingSystem
        OperatingSystem -[hidden]d- Subscriptions
        Subscriptions -[hidden]d- Tenant
        Tenant -[hidden]d- MyCustomers
    }
}
}

rectangle "Azure Monitor" <<$Monitor{scale=3}>> as Monitor {
    together {
    rectangle " " as rightbracket <<grey>> {
        rectangle "Insights" as insights <<action>> {
            rectangle "Application Insights" <<$ApplicationInsights{scale=3}>> <<noborder>> as ApplicationInsights 
            rectangle "Container Instances" <<$ContainerInstances{scale=3}>> <<noborder>>  as ContainerInstances
            rectangle "Virtual Machine" <<$VirtualMachine{scale=3}>> <<noborder>> as VirtualMachine
            rectangle "SAP Azure Monitor" <<$SAPAzureMonitor{scale=3}>> <<noborder>> as SAPAzureMonitor
            ApplicationInsights -[hidden]r- ContainerInstances
            ContainerInstances -[hidden]r- VirtualMachine
            VirtualMachine -[hidden]r- SAPAzureMonitor
        }
        rectangle "Visualize" as visualize <<action>> {
        rectangle "Dashboard" <<$Dashboard{scale=3}>> <<noborder>> as Dashboard
            rectangle "Mobile" <<$Mobile{scale=3}>> <<noborder>> as Mobile
            rectangle "Power BI" <<$PowerBI{scale=3}>> <<noborder>> as PowerBI
            rectangle "Workbooks" <<$Workbooks{scale=3}>> <<noborder>> as Workbooks
            Dashboard -[hidden]r- Mobile
            Mobile -[hidden]r- PowerBI
            PowerBI -[hidden]r- Workbooks
        }
        rectangle "Analyze" as analyze <<action>> {
            rectangle "Analysis Services" <<$AnalysisServices{scale=3}>> <<noborder>> as AnalysisServices
            rectangle "Log Analytics Workspaces" <<$LogAnalyticsWorkspaces{scale=3}>> <<noborder>> as LogAnalyticsWorkspaces
            AnalysisServices -[hidden]r- LogAnalyticsWorkspaces
        }
        rectangle "Respond" as respond <<action>> {
            rectangle "Alerts" <<$Alerts{scale=3}>> <<noborder>> as Alerts
            rectangle "VM Scale Sets" <<$VMScaleSets{scale=3}>> <<noborder>> as VMScaleSets
            Alerts -[hidden]r- VMScaleSets
        }
        rectangle "Integrate" as integrate <<action>> {
            rectangle "Logic Apps" <<$LogicApps{scale=3}>> <<noborder>> as LogicApps
            rectangle "API Management Services" <<$APIManagementServices{scale=3}>> <<noborder>> as APIManagementServices
            LogicApps -[hidden]r- APIManagementServices
        }
        }
    }
    together {
    rectangle " " <<db>> as db {
        database "Metrics" <<$Metrics{scale=3}>> <<noborder>> as Metrics
        database "Activity Log" <<$ActivityLog{scale=3}>> <<noborder>> as ActivityLog
        Metrics -[hidden]r- ActivityLog
        }
    }
}
'Actions relationships (hidden)
insights -[hidden]d- visualize
visualize -[hidden]d- analyze
analyze -[hidden]d- respond
respond -[hidden]d- integrate

'/

@enduml