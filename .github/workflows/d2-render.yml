name: Render D2 Diagrams

on:
  push:
    paths:
      - '**.d2'
  workflow_dispatch:

jobs:
  render:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout docs repo
        uses: actions/checkout@v4

      - name: Clone icons repo
        run: |
          git clone https://github.com/YOUR_ORG/icons-repo.git icons

      - name: Install D2 CLI
        run: |
          curl -fsSL https://d2lang.com/install.sh | sh
          sudo mv d2 /usr/local/bin

      - name: Render .d2 to .svg
        run: |
          mkdir -p diagrams/rendered
          for f in diagrams/raw/*.d2; do
            name=$(basename "$f" .d2)
            d2 "$f" "diagrams/rendered/$name.svg"
          done

      - name: Commit SVGs
        run: |
          git config user.name "D2 Bot"
          git config user.email "bot@example.com"
          git add diagrams/rendered/*.svg
          git commit -m "Auto-rendered D2 diagrams"
          git push || echo "Nothing to commit"
