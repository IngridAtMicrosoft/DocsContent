<svg xmlns="http://www.w3.org/2000/svg" width="0" height="0">
  <script src="https://unpkg.com/d2@latest/web/d2.min.js"></script>
  <script>
    function renderAllD2Blocks() {
      const parentDoc = window.parent.document;
      const blocks = parentDoc.querySelectorAll('pre > code.language-d2');

      blocks.forEach((code) => {
        const source = code.textContent;
        const container = document.createElement('div');
        container.style.border = '1px solid #ccc';
        container.style.margin = '1em 0';
        container.style.overflow = 'auto';

        const pre = code.parentElement;
        pre.parentElement.replaceWith(container);

        D2.render({ src: source, container });
      });
    }

    function waitUntilReady() {
      if (typeof window.parent.D2 !== 'undefined') {
        renderAllD2Blocks();
      } else if (typeof D2 !== 'undefined') {
        window.parent.D2 = D2; // Expose D2 to parent
        renderAllD2Blocks();
      } else {
        setTimeout(waitUntilReady, 100);
      }
    }

    waitUntilReady();
  </script>
</svg>
