<?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>
      .cls-1 {
        fill: #fff;
        stroke: #fff;
        stroke-miterlimit: 10;
      }
    </style>
  </defs>
  <rect class="cls-1" x="0" y="0" width="100" height="100"/>
  <script>

//See if the player is available
function getPlayer(){
  var iframe = document.getElementById('ltiContentFrame');
  if (iframe.contentWindow.GetPlayer) {
    return iframe.contentWindow.GetPlayer();
  } else {
    return null;
  }
}

//Function for passing variables to Storyline
function setStorylineVariable() {
    console.log("setStorylineVariable called.");
    console.log("Getting player.")
    var player = getPlayer();
    if(player){
      // Set the Storyline variable
    console.log("Setting variables")
    player.SetVar("usermail", userEmail);
    player.SetVar("username", userName);
    } else {
      setTimeout(setStorylineVariable, 100)
    }
}

document.addEventListener('DOMContentLoaded', function() {
  console.log("DOMContentLoaded")
  var iframe = parent.document.getElementById('ltiContentFrame');
  var anchors = parent.document.querySelectorAll('a');
  // Iterate over each anchor tag
  anchors.forEach((anchor) => {
    // Check if the href attribute starts with "cloud"
    //if (anchor.href.startsWith("https://cloud.scorm.com")) {
    if (anchor.href.startsWith("https://green-bay-0a20ceb0f")) {
      //console.log('Found href starting with "cloud.scorm.com":', anchor.href);
      console.log('Found href starting with "https://green-bay-0a20ceb0f":', anchor.href);
      iframe.src = anchor.href
    }
  });
  console.log("Calling setStorylineVariable")
  setStorylineVariable()
});

//Get username and email
var userName = parent.document.querySelector('#ms--user-display-name').textContent;
var userEmail = parent.document.querySelector('p[data-profile-property="upn"]').textContent;

console.log('User Name:', userName);
console.log('Email Address:', userEmail);

  </script>
</svg>